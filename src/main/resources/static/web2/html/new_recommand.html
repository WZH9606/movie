<!DOCTYPE html>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>电影推荐</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../css/swiper.min.css"/>
    <link rel="stylesheet" type="text/css" href="../css/basis.css"/>
		<link rel="stylesheet" type="text/css" href="../css/admin.css"/>
    <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/respond.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/jquery.sidr.min.js"></script>
    <!--[if lt IE 9]>
		<script src="../js/html5shiv.min.js"></script>
		<script src="../js/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<header>
			<div class="top-box">
				<div class="container">
					<div class="nav-box clearfix">
						<h1 class="fl logo">
							电影系统推荐
						</h1>
						<nav class="fr">
							<ul class="nav-list clearfix">
								<li><a href="#" id="old_username">用户名</a></li>
								<li><a href="old_recommand.html">电影推荐</a></li>
								<li class="dq"><a href="new_recommand.html">电影评分</a></li>
								<li><a href="login.html">退出</a></li>
							</ul>
						</nav>
					</div>
					
				</div>
			</div>
		</header>
	    <section>
		   	<div class="box2">
		   		<div class="container">
		   			<div id="show_film" class="title-01">
			    		<h2>电影推荐</h2>
						<button id="recommand" class="btn btn-bg">确定</button>
						<button id="reset" class="btn btn-bg">重置</button>
		    		</div>
	   				<ul id="movies_description" class="row clearfix sy-allist sy-allist-newheiglt">
						<li class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
							<div class="sy-albox">
								<img class="admin_img" id="l1_1" src="../img/abt-bg.jpg"/>
								<h3 id="l1_2"> xxx 电影</h3>
								<div>评分：<input id="l1_input" class="rating_input" /></div>
								<div id="l1_3">发布时间</div>
								<div id="l1_4">导演</div>
								<div id="l1_5">主演</div>
								<div id="l1_6">评分</div>
								<div id="l1_7">位置</div>
								<div id="l1_8">描述</div>
								<div id="l1_9">类型</div>
							</div>
						</li>
						<li class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
							<div class="sy-albox">
								<img class="admin_img" id="l2_1" src="../img/abt-bg.jpg"/>
								<h3 id="l2_2"> xxx 电影</h3>
								<div>评分：<input id="l2_input" class="rating_input" /></div>
								<div id="l2_3">发布时间</div>
								<div id="l2_4">导演</div>
								<div id="l2_5">主演</div>
								<div id="l2_6">评分</div>
								<div id="l2_7">位置</div>
								<div id="l2_8">描述</div>
								<div id="l2_9">类型</div>
							</div>
						</li>
						<li class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
							<div class="sy-albox">
								<img class="admin_img" id="l3_1" src="../img/abt-bg.jpg"/>
								<h3 id="l3_2"> xxx 电影</h3>
								<div>评分：<input id="l3_input" class="rating_input" /></div>
								<div id="l3_3">发布时间</div>
								<div id="l3_4">导演</div>
								<div id="l3_5">主演</div>
								<div id="l3_6">评分</div>
								<div id="l3_7">位置</div>
								<div id="l3_8">描述</div>
								<div id="l3_9">类型</div>
							</div>
						</li>
						<li class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
							<div class="sy-albox">
								<img class="admin_img" id="l4_1" src="../img/abt-bg.jpg"/>
								<h3 id="l4_2"> xxx 电影</h3>
								<div>评分：<input id="l4_input" class="rating_input" /></div>
								<div id="l4_3">发布时间</div>
								<div id="l4_4">导演</div>
								<div id="l4_5">主演</div>
								<div id="l4_6">评分</div>
								<div id="l4_7">位置</div>
								<div id="l4_8">描述</div>
								<div id="l4_9">类型</div>
							</div>
						</li>
						<li class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
							<div class="sy-albox">
								<img class="admin_img" id="l5_1" src="../img/abt-bg.jpg"/>
								<h3 id="l5_2"> xxx 电影</h3>
								<div>评分：<input id="l5_input" class="rating_input" /></div>
								<div id="l5_3">发布时间</div>
								<div id="l5_4">导演</div>
								<div id="l5_5">主演</div>
								<div id="l5_6">评分</div>
								<div id="l5_7">位置</div>
								<div id="l5_8">描述</div>
								<div id="l5_9">类型</div>
							</div>
						</li>
						<li class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
							<div class="sy-albox">
								<img class="admin_img" id="l6_1" src="../img/abt-bg.jpg"/>
								<h3 id="l6_2"> xxx 电影</h3>
								<div>评分：<input id="l6_input" class="rating_input" /></div>
								<div id="l6_3">发布时间</div>
								<div id="l6_4">导演</div>
								<div id="l6_5">主演</div>
								<div id="l6_6">评分</div>
								<div id="l6_7">位置</div>
								<div id="l6_8">描述</div>
								<div id="l6_9">类型</div>
							</div>
						</li>
						<li class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
							<div class="sy-albox">
								<img class="admin_img" id="l7_1" src="../img/abt-bg.jpg"/>
								<h3 id="l7_2"> xxx 电影</h3>
								<div>评分：<input id="l7_input" class="rating_input" /></div>
								<div id="l7_3">发布时间</div>
								<div id="l7_4">导演</div>
								<div id="l7_5">主演</div>
								<div id="l7_6">评分</div>
								<div id="l7_7">位置</div>
								<div id="l7_8">描述</div>
								<div id="l7_9">类型</div>
							</div>
						</li>
						<li class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
							<div class="sy-albox">
								<img class="admin_img" id="l8_1" src="../img/abt-bg.jpg"/>
								<h3 id="l8_2"> xxx 电影</h3>
								<div>评分：<input id="l8_input" class="rating_input" /></div>
								<div id="l8_3">发布时间</div>
								<div id="l8_4">导演</div>
								<div id="l8_5">主演</div>
								<div id="l8_6">评分</div>
								<div id="l8_7">位置</div>
								<div id="l8_8">描述</div>
								<div id="l8_9">类型</div>
							</div>
						</li>
						<li class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
							<div class="sy-albox">
								<img class="admin_img" id="l8_1" src="../img/abt-bg.jpg"/>
								<h3 id="l9_2"> xxx 电影</h3>
								<div>评分：<input id="l9_input" class="rating_input" /></div>
								<div id="l9_3">发布时间</div>
								<div id="l9_4">导演</div>
								<div id="l9_5">主演</div>
								<div id="l9_6">评分</div>
								<div id="l9_7">位置</div>
								<div id="l9_8">描述</div>
								<div id="l9_9">类型</div>
							</div>
						</li>
	   				</ul>
		   		</div>
		   	</div>
		</section>
		<footer>
			<div class="foot-box">
				<div class="container clearfix">
					<div class="fl foot-fq">
						<p>版权所有：xxx 有限公司</p>
						<p>地 址 ：xxx 地址  </p>
						<p>总 机 ：123456</p>
					</div>
					<div class="fr foot-fq">
						<p>官方微信: 123456</p>
						<p>官方QQ: 123456</p>
					</div>
				</div>
			</div>
		</footer>
	<script>
        $(function(){
            /*判断上次是否勾选记住密码和自动登录*/
            var userId = localStorage.getItem("userId");
            var userName = localStorage.getItem("userName");
            $("#old_username").html(userName);

            function newajax() {
                $.ajax({
                    type:"get",
                    url: "http://localhost:10086/rec/ramdomMovies",
                    async:false,
                    dataType: 'json',
                    success: function(res){
						var movies = res.data;
                        for(var i=0;i< 9;i++){

                            localStorage.setItem("l" + (i+1) + "_movieid",movies[i].movieid);
                            $("#l" + (i+1) + "_1").attr('src',movies[i].picture);
                            $("#l" + (i+1) + "_2").html(movies[i].moviename);
                            $("#l" + (i+1) + "_3").html("发布时间：" +movies[i].releasetime.slice(0,10));
                            $("#l" + (i+1) + "_4").html("导演：" +movies[i].director.slice(0,30) + "...");
                            $("#l" + (i+1) + "_5").html("主演：" +movies[i].leadactors.slice(0,30) + "...");
                            $("#l" + (i+1) + "_6").html("评分：" +movies[i].averating);
                            $("#l" + (i+1) + "_7").html("位置：" +movies[i].numrating);
                            $("#l" + (i+1) + "_8").html("描述：" +movies[i].description.slice(0,100) + "...");
                            $("#l" + (i+1) + "_9").html("类型：" +movies[i].typelist);

                            $("#l" + (i+1) + "_input").attr('value',0);
                        }
                    },
                    error: function () {
                        alert("获取失败")
                        localStorage.setItem("l1_movieid",1);
                    }
                });
            }
            // //放入页面的容器显示
            newajax();

            $("#recommand").click(function(){
				var rec_params = [];
                for (var i = 0; i < 9; i++) {
                    var score = $("#l" + (i+1) + "_input").val();
                    var movieId = localStorage.getItem("l" + (i+1) + "_movieid");
                    rec_params.push({
						"movieId": parseInt(movieId),
						"score": parseInt(score)
					})
                }

                var userId = localStorage.getItem("userId");

                $.ajax({
                    type:"post",
                    url:"http://localhost:10086/rec/score?userId=" + userId,
                    data: JSON.stringify(rec_params),
                    async:false,
                    dataType: 'json',
                    contentType:"application/json;charset=UTF-8",
                    success: function(res){
                        alert("评分成功");
                        location="old_recommand.html"
                    },
                    error: function () {
                        alert("评分失败");
                    }
                });
            });

            $("#reset").click(function(){
                for (var i = 0; i < 9; i++) {
                    $("#l" + (i+1) + "_input").val(0);
                }
            });



        })
	</script>
	
	</body>
</html>
